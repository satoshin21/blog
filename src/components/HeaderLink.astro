---
import type { HTMLAttributes } from 'astro/types';

type Props = HTMLAttributes<'a'> & {
	/** Blog リンク用: トップ (/) と /blog/ 配下の記事で active にする */
	isBlogSection?: boolean;
};

const { href, class: className, isBlogSection = false, ...props } = Astro.props;
const baseUrl = (import.meta.env.BASE_URL ?? '').replace(/\/$/, '');
const baseUrlWithSlash = baseUrl ? baseUrl + '/' : '';
const hrefStr = href != null ? String(href) : '';
const fullHref = baseUrlWithSlash + (hrefStr === '/' ? '' : hrefStr.replace(/^\//, ''));
const pathname = Astro.url.pathname.replace(baseUrl, '').replace(/\/+$/, '') || '/';
const pathnameNorm = pathname === '' ? '/' : pathname;
const subpath = pathnameNorm.match(/[^/]+/g);

let isActive = hrefStr === pathnameNorm || hrefStr === '/' + (subpath?.[0] ?? '');
if (isBlogSection && hrefStr === '/') {
	// トップ (/) と /blog 配下 (記事ページ) のとき active
	const isBlogPath =
		pathnameNorm === '/' ||
		pathnameNorm === '' ||
		pathnameNorm.startsWith('/blog') ||
		pathnameNorm === 'blog' ||
		pathnameNorm.startsWith('blog/');
	isActive = isBlogPath;
}
---

<a href={fullHref} class:list={[className, { active: isActive }]} {...props}>
	<slot />
</a>
<style>
	a {
		display: inline-block;
		text-decoration: none;
	}
	a.active {
		font-weight: bolder;
		text-decoration: none;
	}
</style>
